#!/bin/bash

read -r -a units

if (( ${#units[@]} == 0 )); then
	exit 1
fi

system_service_manager=0 user_service_manager=0

if systemd-analyze verify -- "${units[@]}" >/dev/null 2>&1; then
	system_service_manager=1
fi

if systemd-analyze --user verify -- "${units[@]}" >/dev/null 2>&1; then
	user_service_manager=1
fi

if (( system_service_manager )); then
	echo systemctl restart -- ${units[@]@Q}
	if (( ${#units[@]} > 1 )); then
		printf "systemctl status -- %s\n" "${units[@]@Q}"
	fi
	echo journalctl --follow $(printf -- '--unit=%s ' "${units[@]@Q}")
	if (( ${#units[@]} > 1 )); then
		printf "journalctl --follow --unit=%s\n" "${units[@]@Q}"
	fi
fi

if (( user_service_manager )); then
	echo systemctl --user restart -- ${units[@]@Q}
	if (( ${#units[@]} > 1 )); then
		printf "systemctl --user status -- %s\n" "${units[@]@Q}"
	fi
	echo journalctl --user --follow $(printf -- '--unit=%s ' "${units[@]@Q}")
	if (( ${#units[@]} > 1 )); then
		printf "journalctl --user --follow --unit=%s\n" "${units[@]@Q}"
	fi
fi
