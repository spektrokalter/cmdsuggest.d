#!/bin/bash

read -r -a units

if (( ${#units[@]} == 0 )); then
	exit 1
fi

for u in "${units[@]}"; do
	case "$u" in
	*.service|*.socket|*.device|*.mount|*.automount|*.swap|*.target|*.path|*.timer|*.slice|*.scope)
		;;
	*)
		exit 1
		;;
	esac
done

system_service_manager=0 user_service_manager=0

if systemctl status -- "${units[@]}" >/dev/null 2>&1; (( $? != 4 )); then
	system_service_manager=1
fi

if systemctl --user status -- "${units[@]}" >/dev/null 2>&1; (( $? != 4 )); then
	user_service_manager=1
fi

if (( !system_service_manager && !user_service_manager )); then
	exit 1
fi

systemctl=(systemctl)
journalctl=(journalctl)
if (( user_service_manager )); then
	systemctl+=(--user)
	journalctl+=(--user)
fi

cat <<-EOF
	${systemctl[@]} restart -- ${units[@]@Q}
	$(printf "${systemctl[*]} status -- %s\n" "${units[@]@Q}")
	${journalctl[@]} --follow $(printf -- '--unit=%s ' "${units[@]@Q}")
EOF
