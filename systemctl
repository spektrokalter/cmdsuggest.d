#!/bin/bash

read -r -a units

if (( ${#units[@]} == 0 )); then
	exit 1
fi

system_service_manager=0 user_service_manager=0

if systemd-analyze verify -- "${units[@]}" >/dev/null 2>&1; then
	system_service_manager=1
fi

if systemd-analyze --user verify -- "${units[@]}" >/dev/null 2>&1; then
	user_service_manager=1
fi

if (( !system_service_manager && !user_service_manager )); then
	exit 1
fi

systemctl=(systemctl)
journalctl=(journalctl)
if (( user_service_manager && !system_service_manager )); then
	systemctl+=(--user)
	journalctl+=(--user)
fi

cat <<-EOF
	${systemctl[@]} restart -- ${units[@]@Q}
	$(printf "${systemctl[*]} status -- %s\n" "${units[@]@Q}")
	${journalctl[@]} --follow $(printf -- '--unit=%s ' "${units[@]@Q}")
EOF
