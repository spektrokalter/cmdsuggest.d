#!/bin/bash

# assume $1 and $2 are already escaped
#
print_suggestions() {
	local systemctl="$1" journalctl="$2"
	shift 2
	local units=("$@")

	printf '%s restart -- %s\n' "$systemctl" "${units[*]@Q}"

	local u
	for u in "${units[@]}"; do
		cat <<-EOF
			$systemctl status -- ${u@Q}
			$systemctl restart -- ${u@Q}
			$systemctl stop -- ${u@Q}
			$systemctl --full edit -- ${u@Q}
		EOF
	done

	printf '%s --follow %s\n' "$journalctl" "$(printf -- '--unit=%s ' "${units[@]@Q}")"

	if (( ${#units[@]} > 1 )); then
		local u
		for u in "${units[@]}"; do
			printf '%s --follow --unit=%s\n' "$journalctl" "${u@Q}"
		done
	fi

}

read -r -a units

if (( ${#units[@]} == 0 )); then
	exit 1
fi

if systemd-analyze verify -- "${units[@]}" >/dev/null 2>&1; then
	print_suggestions 'systemctl' 'journalctl' "${units[@]}"
fi

if systemd-analyze --user verify -- "${units[@]}" >/dev/null 2>&1; then
	print_suggestions 'systemctl --user' 'journalctl --user' "${units[@]}"
fi
